<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Affitti a Manhattan ≤ $3.000</title>
  <meta name="description" content="Trova rapidamente affitti a Manhattan entro 3000$ con link diretti ai principali portali." />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    html,body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    .card{ transition: transform .15s ease, box-shadow .15s ease; }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.14); }
    .btn{ border-radius: 1rem; padding:.6rem .9rem; }

    /* ==== THEME TOKENS ==== */
    :root{
      --bg: #f6f7f9;     --fg: #0b0b0c;
      --surface: #ffffff;--muted: #495160;
      --border: rgba(0,0,0,.08);
      --accent: #16a34a;
      --warn-bg: rgba(250,204,21,.12);
      --warn-br: rgba(250,204,21,.35);
      --warn-fg: #a16207;
    }
    body{ background: var(--bg); color: var(--fg); }
    .bg-surface{ background: var(--surface) !important; }
    .text-muted{ color: var(--muted) !important; }
    .border-muted{ border-color: var(--border) !important; }
    .glass{ background: rgba(255,255,255,.72) !important; backdrop-filter: blur(8px); }

    /* Dark */
    body.dark{
      --bg: #0b0c10;        --fg: #f7f8fa;
      --surface: #0f1218;   --muted: #9aa3ae;
      --border: rgba(255,255,255,.10);
      --accent: #16a34a;
      --warn-bg: rgba(234,179,8,.12);
      --warn-br: rgba(234,179,8,.35);
      --warn-fg: #eab308;
    }
    /* mapping utilità */
    .btn-accent{ background: var(--accent); color: white; }
    .btn-outline{ border: 1px solid var(--border); color: var(--fg); }
    .warn-box{ border: 1px solid var(--warn-br); background: var(--warn-bg); color: var(--warn-fg); }
    .accent-green-600 { accent-color: var(--accent); }
  </style>
</head>
<body>

  <main class="max-w-6xl mx-auto p-6">
    <!-- Header -->
    <header class="mb-4">
      <h1 class="text-3xl md:text-4xl font-bold">Affitti a Manhattan ≤ <span id="maxRentLabel">$3,000</span></h1>
      <p class="text-sm text-muted mt-1 max-w-3xl">
        Pagina statica, nessuno scraping: genera <strong>link diretti</strong> con filtri precompilati su StreetEasy, Zillow, RentHop, Craigslist e Realtor.
        Alcuni portali potrebbero richiedere un clic aggiuntivo per applicare tutti i filtri.
      </p>
    </header>

    <!-- Controls -->
    <section class="sticky top-0 z-40 -mx-6 px-6 py-3 backdrop-blur glass border-b border-muted">
      <div class="max-w-6xl mx-auto grid md:grid-cols-4 gap-3 items-end">
        <div>
          <label class="block text-sm font-medium mb-1" for="maxRent">Budget massimo ($)</label>
          <input id="maxRent" type="number" value="3000" min="1000" step="50"
                 class="w-full border border-muted rounded-2xl p-3 bg-surface" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" for="bedsMin">Letti min</label>
          <select id="bedsMin" class="w-full border border-muted rounded-2xl p-3 bg-surface">
            <option value="">Qualsiasi</option>
            <option value="0">Studio</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" for="zip">ZIP (opzionale)</label>
          <input id="zip" placeholder="es. 10009" class="w-full border border-muted rounded-2xl p-3 bg-surface" />
        </div>

        <div class="flex flex-wrap gap-2 justify-end items-center">
          <button id="theme" class="btn btn-outline">Tema</button>
          <button id="copy"  class="btn btn-outline">Copia link</button>
          <button id="build" class="btn" style="background:white;color:black;border:1px solid var(--border)">Genera link</button>
          <button id="strict" class="btn btn-accent">Strict ≤$3k</button>
          <button id="save" class="btn btn-outline">Salva</button>
          <label class="flex items-center gap-2 text-sm font-medium ml-1">
            <input id="noFee" type="checkbox" class="w-5 h-5 accent-green-600" />
            No-fee
          </label>
        </div>
      </div>
    </section>

    <!-- ZIP pills -->
    <section class="mt-6 mb-4">
      <h2 class="text-lg font-semibold mb-3">ZIP Manhattan rapidi</h2>
      <div id="zipPills" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Avviso -->
    <section class="mb-6">
      <div class="warn-box rounded-xl px-4 py-3 text-sm">
        ⚠️ StreetEasy e Zillow possono mostrare annunci sponsorizzati o con “net effective rent” sopra i $3.000 anche con filtro attivo.
        Usa <strong>Strict ≤$3k</strong> per risultati garantiti.
      </div>
    </section>

    <!-- Providers -->
    <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="providers"></section>

    <!-- Strict results -->
    <section class="mt-8">
      <h2 class="text-lg font-semibold mb-2">Risultati filtrati (serverless, ≤ $3.000)</h2>
      <div id="strictBox" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      <p class="text-xs text-muted mt-2">Solo annunci ≤ $3.000 a Manhattan (es. Craigslist RSS), filtrati lato server.</p>
    </section>

    <!-- Saved -->
    <section class="mt-10">
      <h2 class="text-lg font-semibold mb-2">Ricerche salvate (locale)</h2>
      <div id="saved" class="grid md:grid-cols-3 gap-3"></div>
    </section>

    <footer class="mt-12 text-xs text-muted">
      <p>Nota: questa pagina non fa scraping e non usa API dei portali. Apre ricerche pubbliche con parametri nell'URL. I parametri dei portali possono cambiare nel tempo.</p>
    </footer>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 pointer-events-none
    px-4 py-2 rounded-xl bg-black/80 text-white text-sm shadow-lg opacity-0 transition-opacity">
    Copiato!
  </div>

  <script>
    // Tema persistente (chiaro di default)
    (function initTheme(){
      const saved = localStorage.getItem('theme');
      if (!saved) { localStorage.setItem('theme','light'); }
      if (saved==='dark') document.body.classList.add('dark');
    })();
    document.getElementById('theme').addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark')?'dark':'light');
    });

    // ZIP pills
    const MANHATTAN_ZIPS = ["10001","10002","10003","10004","10005","10006","10007","10009","10010","10011","10012","10013","10014",
      "10016","10017","10018","10019","10021","10022","10023","10024","10025","10026","10027","10028",
      "10029","10030","10031","10032","10033","10034","10035","10036","10037","10038","10039","10040",
      "10044","10065","10069","10075","10280","10282"];
    const zipPills = document.getElementById("zipPills");
    MANHATTAN_ZIPS.forEach(z => {
      const b = document.createElement("button");
      b.textContent = z;
      b.className = "px-3 py-1 rounded-full border border-gray-400 bg-gray-100 text-gray-800 text-sm font-medium hover:bg-green-500 hover:text-white hover:border-green-500 transition";
      b.addEventListener("click", () => { document.getElementById("zip").value = z; });
      zipPills.appendChild(b);
    });

    // resto script = buildProviderCards, loadStrict, salvataggi... (uguale al file precedente)
  </script>
</body>
</html>
