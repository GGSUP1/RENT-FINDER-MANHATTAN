<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KeyCap NYC — Affitti a Manhattan ≤ $3.000</title>
  <meta name="description" content="KeyCap NYC: affitti a Manhattan entro $3.000 con link diretti ai principali portali (StreetEasy, Zillow, RentHop, Craigslist, Realtor). Filtri rapidi e risultati strict." />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    html,body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    .card{ transition: transform .15s ease, box-shadow .15s ease; }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.14); }
    .btn{ border-radius: 1rem; padding:.6rem .9rem; }

    :root{
      --bg: #f6f7f9; --fg: #0b0b0c;
      --surface: #ffffff; --muted: #495160;
      --border: rgba(0,0,0,.08); --accent: #16a34a;
    }
    body{ background: var(--bg); color: var(--fg); }
    .bg-surface{ background: var(--surface); }
    .text-muted{ color: var(--muted); }
    .border-muted{ border-color: var(--border); }
    body.dark{
      --bg: #0b0c10; --fg: #f7f8fa;
      --surface: #0f1218; --muted: #9aa3ae;
      --border: rgba(255,255,255,.1);
    }

    /* Segmented compact */
    .seg{ display:flex; flex-wrap:wrap; gap:.5rem; }
    .seg-btn{
      width:96px;height:40px;font-size:.9rem;font-weight:700;
      border:1px solid var(--border); background:var(--surface); color:var(--fg);
      border-radius:12px;display:inline-flex;align-items:center;justify-content:center;
    }
    .seg-btn.seg-active{ background:var(--accent)!important; color:#fff!important; border-color:var(--accent)!important; }

    .zip-btn-active{ background: var(--accent)!important; color:#fff!important; border-color: var(--accent)!important; }
  </style>
</head>
<body>

<main class="max-w-6xl mx-auto p-6">

  <!-- Header con logo -->
  <header class="flex items-center gap-3 py-4 border-b border-muted mb-6">
    <!-- Logo KeyCap -->
    <svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"
         class="rounded-xl shadow-sm flex-shrink-0">
      <rect width="44" height="44" rx="10" fill="#16a34a"/>
      <text x="50%" y="50%" text-anchor="middle" dy=".35em"
            font-size="22" font-family="Inter, sans-serif" font-weight="700"
            fill="white">K</text>
    </svg>

    <div class="min-w-0">
      <h1 class="text-3xl md:text-4xl font-black tracking-tight leading-none">
        KeyCap <span class="text-[#16a34a]">NYC</span>
      </h1>
      <p class="text-sm text-muted mt-1">
        Affitti smart a Manhattan ≤ <span id="maxRentLabel">$3,000</span>
      </p>
    </div>
  </header>

  <!-- Controls -->
  <section class="grid md:grid-cols-4 gap-3 items-end mb-6">
    <div>
      <label class="block text-sm font-medium mb-1" for="maxRent">Budget massimo ($)</label>
      <input id="maxRent" type="number" value="3000" min="1000" step="50"
             class="w-full border border-muted rounded-2xl p-3 bg-surface" />
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Letti min</label>
      <div id="bedsSeg" class="seg">
        <button type="button" data-beds=""  class="seg-btn seg-active">Qualsiasi</button>
        <button type="button" data-beds="0" class="seg-btn">Studio</button>
        <button type="button" data-beds="1" class="seg-btn">1+</button>
        <button type="button" data-beds="2" class="seg-btn">2+</button>
        <button type="button" data-beds="3" class="seg-btn">3+</button>
      </div>
      <input id="bedsMin" type="hidden" value="">
    </div>
    <div>
      <label class="block text-sm font-medium mb-1" for="zip">ZIP (opzionale)</label>
      <input id="zip" placeholder="es. 10009" class="w-full border border-muted rounded-2xl p-3 bg-surface" />
    </div>
    <div class="flex flex-wrap gap-2 justify-end items-center">
      <button id="build" class="btn border border-muted bg-surface">Genera link</button>
      <button id="strict" class="btn bg-[#16a34a] text-white">Strict ≤$3k</button>
      <button id="save" class="btn border border-muted bg-surface">Salva</button>
      <label class="flex items-center gap-2 text-sm font-medium ml-1">
        <input id="noFee" type="checkbox" class="w-5 h-5 accent-[#16a34a]" />
        No-fee
      </label>
    </div>
  </section>

  <!-- ZIP pills -->
  <section class="mt-6 mb-2">
    <h2 class="text-lg font-semibold mb-3">ZIP Manhattan rapidi</h2>
    <div id="zipPills" class="grid grid-cols-10 gap-2 mt-4 text-sm"></div>
  </section>

  <!-- Quartieri rapidi -->
  <section class="mt-4">
    <h3 class="font-semibold mb-2">Quartieri rapidi</h3>
    <div id="hoodPills" class="flex flex-wrap gap-2"></div>
  </section>

  <!-- Providers -->
  <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="providers"></section>

  <!-- Strict results -->
  <section class="mt-8">
    <h2 class="text-lg font-semibold mb-2">Risultati filtrati (serverless, ≤ $3.000)</h2>
    <div id="strictBox" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>

  <!-- Saved -->
  <section class="mt-10">
    <h2 class="text-lg font-semibold mb-2">Ricerche salvate (locale)</h2>
    <div id="saved" class="grid md:grid-cols-3 gap-3"></div>
  </section>

  <footer class="mt-12 text-xs text-muted">
    <p>Nota: questa pagina non fa scraping. Apre solo ricerche pubbliche con parametri nell'URL.</p>
  </footer>
</main>

<script>
  const MANHATTAN_ZIPS = ['10001','10002','10003','10004','10005','10006','10007','10009','10010','10011','10012','10013','10014','10016','10017','10018','10019','10021','10022','10023','10024','10025','10026','10027','10028','10029','10030','10031','10032','10033','10034','10035','10036','10037','10038','10039','10040','10044','10065','10069','10075','10280','10282'];
  const HOODS = {
  "Chelsea": "10011",
  "West Village": "10014",
  "East Village": "10009",
  "SoHo": "10012",
  "Lower East Side": "10002",
  "Upper West Side": "10024",
  "Upper East Side": "10021",
  "Harlem": "10027",
  "Financial District": "10004",
  "Midtown": "10019"
};

  const fmt = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0});

  function readState(){
    return {
      maxRent: parseInt(document.getElementById('maxRent').value || '3000', 10),
      bedsMin: document.getElementById('bedsMin').value,
      zip: (document.getElementById('zip').value||'').trim(),
      noFee: document.getElementById('noFee').checked
    };
  }
  function updateLabel(){ document.getElementById('maxRentLabel').textContent = fmt.format(readState().maxRent); }
  document.getElementById('maxRent').addEventListener('input', updateLabel);
  updateLabel();

  function renderZipPills(){
    const zipPills = document.getElementById('zipPills');
    const current = document.getElementById('zip').value;
    zipPills.innerHTML='';
    MANHATTAN_ZIPS.forEach(z=>{
      const b=document.createElement('button');
      b.textContent=z;
      b.className='px-3 py-1 rounded-full border text-sm';
      if(current===z) b.classList.add('zip-btn-active');
      b.onclick=()=>{ document.getElementById('zip').value=(current===z)?'':z; renderZipPills(); buildProviderCards(); };
      zipPills.appendChild(b);
    });
  }
  renderZipPills();

  (function renderHoods(){
    const box=document.getElementById('hoodPills');
    Object.entries(HOODS).forEach(([name,zip])=>{
      const b=document.createElement('button');
      b.textContent=name;
      b.className='px-3 py-1 rounded-full border text-sm';
      b.onclick=()=>{ document.getElementById('zip').value=zip; renderZipPills(); buildProviderCards(); };
      box.appendChild(b);
    });
  })();

  function buildProviderCards(){
    const {maxRent,bedsMin,zip,noFee}=readState();
    const p=document.getElementById('providers');
    p.innerHTML='';
    const providers=[
      { name:'StreetEasy', url:`https://streeteasy.com/for-rent/manhattan?max_price=${maxRent}` },
      { name:'Zillow', url:`https://www.zillow.com/manhattan-new-york-ny/rentals/?price=0-${maxRent}` },
      { name:'RentHop', url:`https://www.renthop.com/apartments-for-rent/nyc/manhattan?max_price=${maxRent}` },
      { name:'Craigslist (Manhattan)', url:`https://newyork.craigslist.org/search/mnh/apa?max_price=${maxRent}` },
      { name:'Realtor', url:`https://www.realtor.com/apartments/Manhattan_NY/price-na-${maxRent}` }
    ];
    providers.forEach(pr=>{
      const a=document.createElement('a');
      a.href=pr.url; a.target='_blank'; a.className='card block border rounded-2xl bg-surface p-4';
      a.innerHTML=`<h3 class="font-semibold">${pr.name}</h3><p class="text-sm text-muted">Max ${fmt.format(maxRent)}</p>`;
      p.appendChild(a);
    });
  }
  buildProviderCards();
</script>
</body>
</html>
