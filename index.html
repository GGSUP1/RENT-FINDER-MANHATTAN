<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KeyCap NYC — Lease Hunter ≤ $3.000</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{font-family:Inter,system-ui;background:#0b0c10;color:#f7f8fa;}
    .surface{background:#11151c;border:1px solid rgba(255,255,255,.12);}
    .btn{height:40px;padding:0 .9rem;border-radius:.8rem;font-weight:700;font-size:.9rem;display:inline-flex;align-items:center;gap:.45rem;}
    .btn-ghost{border:1px solid rgba(255,255,255,.12);background:#11151c;}
    .btn-outline{border:1px solid rgba(255,255,255,.12);background:#fff;color:#000;}
    .btn-primary{background:#16a34a;color:#fff;}
    .chip{height:34px;padding:0 .7rem;border-radius:.7rem;border:1px solid rgba(255,255,255,.12);font-size:.85rem;font-weight:700;}
    .chip-active{background:#16a34a;border-color:#16a34a;color:#fff;}
    .card{background:#11151c;border:1px solid rgba(255,255,255,.12);border-radius:1rem;padding:1rem;}
    .input,.select{height:40px;border-radius:.8rem;border:1px solid rgba(255,255,255,.12);background:#11151c;padding:.35rem .8rem;color:#f7f8fa;}
  </style>
</head>

<body>
<main class="max-w-6xl mx-auto p-6">

  <header class="flex items-center gap-3 py-4 border-b border-white/10 mb-6">
    <h1 class="text-3xl font-black">KeyCap <span class="text-green-600">NYC</span></h1>
    <p class="text-sm text-gray-400">Lease Hunter ≤ <span id="maxRentLabel">$3,000</span></p>
  </header>

  <section class="mb-4">
    <div class="surface rounded-xl px-4 py-3 text-sm text-yellow-400">
      Strict mostra solo risultati ≤ $3k (Craigslist filtrato).
    </div>
  </section>

  <section class="space-y-4 mb-6">
    <div class="grid md:grid-cols-5 gap-3">
      <div>
        <label class="text-xs font-semibold mb-1 block">Area</label>
        <select id="area" class="select w-full">
          <option value="manhattan">Manhattan</option>
          <option value="harlem">Harlem</option>
          <option value="upper_manhattan">Upper Manhattan</option>
          <option value="brooklyn">Brooklyn</option>
          <option value="queens">Queens</option>
        </select>
      </div>
      <div>
        <label class="text-xs font-semibold mb-1 block">Budget</label>
        <input id="maxRent" type="number" value="3000" class="input w-full"/>
      </div>
      <div>
        <label class="text-xs font-semibold mb-1 block">Letti</label>
        <select id="bedsMin" class="select w-full">
          <option value="">Qualsiasi</option>
          <option value="0">Studio</option>
          <option value="1">1+</option>
          <option value="2">2+</option>
          <option value="3">3+</option>
        </select>
      </div>
      <div>
        <label class="text-xs font-semibold mb-1 block">ZIP</label>
        <input id="zip" class="input w-full" placeholder="es. 10009"/>
      </div>
      <div class="flex items-center justify-end gap-2">
        <button id="build" class="btn btn-outline">Genera</button>
        <button id="strict" class="btn btn-primary">Strict</button>
      </div>
    </div>

    <div class="flex flex-wrap gap-4 items-center text-sm font-semibold">
      <label class="flex items-center gap-2"><input id="noFee" type="checkbox"/> No-fee</label>
      <label class="flex items-center gap-2"><input id="leaseTakeover" type="checkbox"/> Lease takeover</label>
      <label class="flex items-center gap-2"><input id="directOwner" type="checkbox"/> Direct owner</label>
      <label class="flex items-center gap-2"><input id="corpAssignable" type="checkbox"/> Corporate/Assignable</label>
      <label class="flex items-center gap-2"><input id="fullApt" type="checkbox"/> Full Apartment (no rooms)</label>
      <label class="flex items-center gap-2"><input id="unfurnished" type="checkbox"/> Unfurnished only</label>
      <label class="flex items-center gap-2"><input id="vacant" type="checkbox"/> Vacant / Available now</label>
    </div>
  </section>

  <section class="mt-2 mb-4">
    <h2 class="text-base font-semibold mb-2">Quartieri</h2>
    <div id="nabePills" class="flex flex-wrap gap-2"></div>
  </section>

  <section id="providers" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-10"></section>

  <section class="mt-8">
    <h2 class="text-base font-semibold mb-2">Strict ≤ $3.000</h2>
    <div id="strictBox" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>

</main>

<script>
/* === Quartieri === */
const NABES = {
 manhattan:[
  {n:"SoHo",z:"10012"},{n:"Tribeca",z:"10013"},{n:"Chelsea",z:"10011"},
  {n:"West Village",z:"10014"},{n:"Upper West Side",z:"10024"},
  {n:"Upper East Side",z:"10028"},{n:"East Village",z:"10009"},
  {n:"Lower East Side",z:"10002"}
 ],
 brooklyn:[
  {n:"Williamsburg",z:"11211"},{n:"Bushwick",z:"11237"},
  {n:"Greenpoint",z:"11222"},{n:"Park Slope",z:"11215"},
  {n:"Brooklyn Heights",z:"11201"}
 ],
 queens:[
  {n:"Astoria",z:"11102"},{n:"LIC",z:"11101"},
  {n:"Jackson Heights",z:"11372"},{n:"Forest Hills",z:"11375"}
 ],
 harlem:[{n:"Central Harlem",z:"10027"},{n:"East Harlem",z:"10029"}],
 upper_manhattan:[{n:"Washington Heights",z:"10033"},{n:"Inwood",z:"10034"}]
};

/* === Build query terms === */
function qTerms(s){
 let t=[];
 if(s.lt) t.push("(lease assignment OR lease takeover OR assume lease OR lease break)");
 if(s.do) t.push("(direct owner OR owner managed OR no broker)");
 if(s.ca) t.push("(corporate lease OR assignable lease)");
 if(s.fa) t.push("(-room -roommate -coliving -share)");
 if(s.uf) t.push("(unfurnished) -furnished");
 if(s.vc) t.push("(vacant OR available now) -occupied");
 return t.join(" ");
}

/* === Build providers === */
function providerLinks(s){
 const enc=encodeURIComponent;
 const q=qTerms(s);
 return [
  {name:"StreetEasy",url:`https://streeteasy.com/for-rent/${s.area}?max_price=${s.max}${s.beds?`&beds=${s.beds}`:''}${s.zip?`&search=zip:${s.zip}`:''}${q?`&search=${enc(q)}`:''}`},
  {name:"Zillow",url:`https://www.zillow.com/${s.area}-new-york-ny/rentals/?price=0-${s.max}${s.beds?`&beds=${s.beds}-_`:''}`},
  {name:"HotPads",url:`https://hotpads.com/${s.area}-ny/apartments-for-rent?price=-${s.max}${s.beds?`&beds=${s.beds}`:''}`},
  {name:"Apartments.com",url:`https://www.apartments.com/${s.zip||s.area}-ny/?max-price=${s.max}`},
  {name:"Realtor.com",url:`https://www.realtor.com/apartments/${s.area}_NY/price-na-${s.max}`},
  {name:"Craigslist",url:`https://newyork.craigslist.org/search/${s.area==="brooklyn"?"brk":s.area==="queens"?"que":"mnh"}/apa?max_price=${s.max}${s.beds?`&min_bedrooms=${s.beds}`:''}${s.zip?`&postal=${s.zip}&search_distance=2`:''}${q?`&query=${enc(q)}`:''}`}
 ];
}

/* === Render providers === */
function build(){
 const s=state();
 const box=document.getElementById("providers");
 box.innerHTML="";
 providerLinks(s).forEach(p=>{
  const el=document.createElement("a");
  el.href=p.url;el.target="_blank";el.className="card";
  el.innerHTML=`<h3 class="font-semibold mb-2">${p.name}</h3>
                <p class="text-sm text-gray-400 break-all">${p.url}</p>`;
  box.appendChild(el);
 });
}

/* === State === */
function state(){
 return {
  area:document.getElementById("area").value,
  max:parseInt(document.getElementById("maxRent").value||3000,10),
  beds:document.getElementById("bedsMin").value,
  zip:document.getElementById("zip").value.trim(),
  lt:document.getElementById("leaseTakeover").checked,
  do:document.getElementById("directOwner").checked,
  ca:document.getElementById("corpAssignable").checked,
  fa:document.getElementById("fullApt").checked,
  uf:document.getElementById("unfurnished").checked,
  vc:document.getElementById("vacant").checked
 };
}

/* === Quartieri === */
function renderNabe(){
 const a=document.getElementById("area").value;
 const box=document.getElementById("nabePills");
 box.innerHTML="";
 (NABES[a]||[]).forEach(o=>{
  const b=document.createElement("button");
  b.className="chip";
  b.textContent=o.n;
  b.onclick=()=>{document.getElementById("zip").value=o.z;build();}
  box.appendChild(b);
 });
}

/* === Strict === */
async function strict(){
 const s=state();
 const box=document.getElementById("strictBox");
 box.innerHTML="Caricamento…";
 try{
  const u=new URLSearchParams();
  u.set("max",s.max);
  if(s.beds)u.set("beds",s.beds);
  if(s.zip)u.set("zip",s.zip);
  const q=qTerms(s);
  if(q)u.set("q",q);
  const r=await fetch("https://rent-finder-manhattan.vercel.app/api/listings?"+u.toString());
  const j=await r.json();
  box.innerHTML="";
  j.data.forEach(l=>{
    const el=document.createElement("div");
    el.className="card";
    el.innerHTML=`<a href="${l.url}" target="_blank" class="font-semibold block mb-2">${l.title}</a>
                  <div class="text-sm text-gray-400">$${l.price} · ZIP ${l.zipcode}</div>`;
    box.appendChild(el);
  });
 }catch(e){
  box.innerHTML="Errore.";
 }
}

/* === Events === */
document.getElementById("build").onclick=build;
document.getElementById("strict").onclick=strict;
document.getElementById("area").onchange=()=>{renderNabe();build();};
document.getElementById("maxRent").oninput=()=>{document.getElementById("maxRentLabel").textContent="$"+document.getElementById("maxRent").value;};

renderNabe();
build();
</script>

</body>
</html>
